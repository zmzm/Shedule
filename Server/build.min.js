/* ScheduleServer 0.0.1 - 2015-07-29 */
var express=require("express"),path=require("path"),bodyParser=require("body-parser"),log=require("./log")(module),fs=require("fs"),app=express(),Shedule=require("./shedule/Shedule");app.use(bodyParser.json()),app.use(bodyParser.urlencoded()),app.use(app.router),app.use(function(a,b,c){b.status(404);var d="public/images/404.jpg",e=fs.readFileSync(d);log.error("Not found URL: %s",a.url),b.contentType="image/jpg",b.end(e,"binary")}),app.use(function(a,b,c,d){c.status(a.status||500),log.error("Internal error(%d): %s",c.statusCode,a.message),c.send({error:a.message})}),app.get("/api",function(a,b){b.send("API is running")}),app.get("/api/schedule",function(a,b){Shedule.getShedule(a.query.date,function(a){b.header("Access-Control-Allow-Origin","*"),b.header("Access-Control-Allow-Headers","X-Requested-With"),b.status(200),b.send(a)})}),app.listen(3e3,function(){log.info("Express server listening on port 3000")});